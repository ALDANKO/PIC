перем ВесВешала;
Процедура КнопкаВзвешиватьНажатие(Элемент)
	//ПоказанияВесов=Весы;
	РасчитатьВес();
	Дата= ТекущаяДата();
КонецПроцедуры

Процедура ПриОткрытии()
	Ответственный=глЗначениеПеременной("глТекущийПользователь");
	Организация=УправлениеПользователями.ПолучитьЗначениеПоУмолчанию(глЗначениеПеременной("глТекущийПользователь"), "ОсновнаяОрганизация");
	Дата = ТекущаяДата();
	Склад=УправлениеПользователями.ПолучитьЗначениеПоУмолчанию(глЗначениеПеременной("глТекущийПользователь"), "ОсновнойСклад");
	Если не ЗначениеЗаполнено(Организация) Тогда
	   Организация=Справочники.Организации.НайтиПоКоду("000000001");
	КонецЕсли; 
	Если не ЗначениеЗаполнено(Склад) Тогда
	   Склад=Справочники.Склады.НайтиПоКоду("000000001");
	КонецЕсли; 	
КонецПроцедуры

Процедура ВесыПриИзменении(Элемент)
	ВесВешалов=КоличествоВешалов*ВесВешала;
	ЭтотОбъект.ПоказанияВесов=Элемент.Значение;
	Количество=МАКС(Элемент.Значение-Рама-ВесВешалов,0);
КонецПроцедуры

Процедура КоличествоВешаловПриИзменении(Элемент)
		РасчитатьВес();
КонецПроцедуры

Процедура РасчитатьВес()
	Весы=0;
	ВесВешалов=КоличествоВешалов*ВесВешала;
	Весы=СчитываниеВесов();
	ЭтотОбъект.ПоказанияВесов=Весы;
	Количество=МАКС(Весы-Рама-ВесВешалов,0);
КонецПроцедуры

Процедура РамаПриИзменении(Элемент)
	РасчитатьВес();
КонецПроцедуры

Процедура НоменклатураНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	МояФорма=Обработки.ВыборТовараЭкспедиция.ПолучитьФорму("Форма");
  	Номенклатура = МояФорма.ОткрытьМодально();	
КонецПроцедуры

Процедура КнопкаВводаКодаПРИКНажатие(Элемент)
	ФормаКод = ПолучитьОбщуюФорму("ФормаВводаПоКоду");
	КодТовар=ФормаКод.ОткрытьМодально();
	НовКод=ДополнительныеФункции.НайтиТоварПоКодПик(КодТовар);
	Если НовКод=Неопределено тогда
		ЭлементыФормы.Номенклатура.Значение=Справочники.Номенклатура.ПустаяСсылка();
		ЭтотОбъект.Номенклатура=Справочники.Номенклатура.ПустаяСсылка();
	Иначе	
		ЭлементыФормы.Номенклатура.Значение=НовКод.Номенклатура;
		ЭтотОбъект.Номенклатура	= НовКод.Номенклатура;
		Если ЭтотОбъект.Номенклатура.ПометкаУдаления И Вопрос("Эта номенклатура помечена на удаление! "+Символы.ПС+" Продолжить?",РежимДиалогаВопрос.ДаНет,,,"Внимание")=КодВозвратаДиалога.Нет Тогда
			ЭлементыФормы.Номенклатура.Значение=Справочники.Номенклатура.ПустаяСсылка();
			ЭтотОбъект.Номенклатура=Справочники.Номенклатура.ПустаяСсылка();
		КонецЕсли;
	КонецЕсли;	
КонецПроцедуры

Функция СчитываниеВесов()
   ТекВес=0;
	try
		scale = Новый COMОбъект("Ci2001A.Indic");
	except
		Message("dll для весов CAS не инициирован!");
		return ТекВес;
	endtry;
	мТекПользователь=ИмяПользователя();
	Свойство=СокрЛП("COM порт №1");
	Отбор = Новый Структура; 
	Отбор.Вставить("Пользователь", Справочники.Пользователи.НайтиПоНаименованию(СокрЛП(мТекПользователь))); 
	Отбор.Вставить("Настройка", ПланыВидовХарактеристик.НастройкиПользователей.НайтиПоНаименованию(СокрЛП(Свойство))); 
	Результат = РегистрыСведений.НастройкиПользователей.Получить(Отбор); 
	НовоеЗначение=Результат.Значение;
	//НовоеЗначение=1;
	Если Строка(НовоеЗначение)="0" или Строка(НовоеЗначение)=""  тогда
		 	Message("СОМ порт не найден, работа с весами невозможна!");
		return ТекВес;
	КонецЕсли;
	scale.NumberOfCom =НовоеЗначение;
	try
		scale.Open();//Connect(Результат.Значение,0);
	except
		Message("Нет подключения к веам.");
	endtry;

	// Чтение веса:	
	try
		scale.Update();
	except
		// Первая попытка не удалась, пробуем ещё раз!
		try
			scale.Update();
		except
			// Вторая попытка не удалась, пробуем ещё раз!
			try
				scale.Update();
			except
				Message("нет подключения третий раз.");
			endtry;
		endtry;
	endtry;
	
	ТекВес=scale.Weight;
	try
		scale.Close();
	except
			try
				scale.Close();
			except
			endtry;
	endtry;
	возврат ТекВес;	
КонецФункции





ВесВешала=0.360;